<html>
    <head>
        <style>
            html, body {
                margin: 0;
                padding: 0;
            }
        </style>
    </head>
    <body>
        <canvas></canvas>
        <script type="module">
            import { Renderer, Mesh, Program, Geometry } from '../src/index.mjs'

            let renderer
            let geometry
            let program
            let mesh

            function init() {
                // Renderer
                renderer = new Renderer({
                    canvas: document.querySelector('canvas')
                })
                renderer.setPixelRatio(1)
                renderer.setSize(innerWidth, innerHeight)

                // Geometry
                geometry = new Geometry({
                    position: {
                        name: 'position',
                        value: new Float32Array([-1, -1, 3, -1, -1, 3]),
                        size: 2
                    },
                    uv: {
                        name: 'uv',
                        value: new Float32Array([0, 0, 2, 0, 0, 2]),
                        size: 2
                    }
                })
                
                // Program / shader
                program = new Program({
                    vertex: `#version 300 es
                    
                        in vec3 position;
                        in float time;
                        in vec2 uv;
                        out vec2 vUv;

                        mat4 scale(vec3 scale) {
                            return mat4(
                                scale.x, 0.0, 0.0, 0.0,
                                0.0, scale.y, 0.0, 0.0,
                                0.0, 0.0, scale.z, 0.0,
                                0.0, 0.0, 0.0, 1.0
                            );
                        }

                        void main() {
                            vUv = uv;
                            vec4 pos = scale(vec3(cos(time))) * vec4(position, 1.0);
                            gl_Position = vec4(pos.xy, 0.0, 1.0);
                        }
                    `,
                    fragment: `#version 300 es
                        precision highp float;

                        in vec2 vUv;
                        out vec4 fragColor;

                        void main() {
                            fragColor = vec4(vUv, 0.0, 1.0);
                        }
                    `,
                    time: {
                        value: 0,
                        type: 'float'
                    }
                })
                
                // Mesh
                mesh = new Mesh(geometry, program)

                console.log({renderer, program, geometry, mesh});
            }

            function update() {
                requestAnimationFrame(update)
                
                renderer.gl.clearColor(0, 0, 0, 1)
                renderer.clear(true, true, true)
                
                renderer.render(mesh)
                
                program.uniforms.time.value += 0.01
            }

            init()
            update()
            
        </script>
    </body>
</html>